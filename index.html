<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sonar Rock - La Radio Independiente</title>
  <link href="style.css" rel="stylesheet" type="text/css" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#ff6600">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Favicon general -->
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="shortcut icon" href="/icons/favicon.ico">

  <!-- Apple Touch Icon -->
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
  <meta name="apple-mobile-web-app-title" content="Sonar Rock">

  <!-- Android Chrome Icons -->
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-chrome-192x192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="/icons/android-chrome-512x512.png">

  <!-- Evita traducci√≥n autom√°tica en Chrome -->
  <meta name="google" content="notranslate">
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="container">
      <div class="logo-section">
        <img src="attached_assets/logo_1749601460841.jpeg" alt="Sonar Rock Logo" class="logo">
        <div class="title-section">
          <h1>LA RADIO INDEPENDIENTE</h1>
        </div>
      </div>
    </div>
  </header>

<!-- PLAYER -->
<section class="main-section">
  <div class="container">
    <div class="main-image-container">
      <img src="attached_assets/Sonarrock_1749601460841.jpeg" alt="Sonar Rock" class="main-image">

      <div class="radio-player" role="region" aria-label="Reproductor Sonar Rock en vivo">
        <div class="player-header">
          <span class="live-dot" aria-hidden="true"></span>
          <span class="live-text">En vivo Mi√©rcoles 21:00</span>
        </div>

        <!-- Visualizador -->
        <canvas id="waveform" aria-hidden="true"></canvas>

        <!-- Controles -->
        <div class="player-controls">
          <button class="play-btn" id="playPauseBtn" aria-label="Reproducir / Pausar">
            <span id="playIcon">‚ñ∂</span>
            <span id="pauseIcon" style="display:none;">‚ùö‚ùö</span>
          </button>
        </div>

        <!-- Volumen -->
        <div class="volume-row">
          <button class="vol-btn" id="muteBtn" aria-label="Silenciar / Activar sonido">üîä</button>
          <input type="range" id="volumeRange" min="0" max="1" step="0.01" value="0.8" aria-label="Control de volumen">
        </div>
      </div>

      <!-- STREAM AUDIO -->
      <audio id="audioPlayer" preload="metadata" playsinline crossorigin="anonymous">
        <source src="https://stream.zeno.fm/ezq3fcuf5ehvv" type="audio/mpeg">
        Tu navegador no soporta audio HTML5.
      </audio>
    </div>
  </div>
</section>

<style>
/* Mismos estilos, se mantienen */
.radio-player{
  background: rgba(0,0,0,0.7);
  border-radius: 16px;
  padding: 16px 18px;
  width: 100%;
  box-sizing: border-box;
  margin-top: 20px;
  color:#fff;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  box-shadow: 0 4px 16px rgba(0,0,0,.5);
}
.player-header{display:flex;align-items:center;gap:8px;margin-bottom:12px}
.live-dot{width:10px;height:10px;border-radius:50%;background:#ff8a00;animation:blink 1s infinite;}
.live-text{font-size:14px;font-weight:700}
@keyframes blink{0%,50%,100%{opacity:1}25%,75%{opacity:0}}
#waveform{width:100%;height:70px;display:block;margin:10px 0}
.player-controls{display:flex;justify-content:center;margin-top:6px}
.play-btn{background:#ff8a00;border:none;border-radius:50%;width:70px;height:70px;
  cursor:pointer;font-size:30px;color:#fff;display:flex;align-items:center;justify-content:center;
  transition:transform .2s ease;}
.play-btn:hover{transform:scale(1.06)}
.volume-row{margin-top:14px;display:flex;align-items:center;gap:10px;}
.vol-btn{background:transparent;border:1px solid rgba(255,255,255,.2);color:#fff;border-radius:10px;
  padding:6px 10px;cursor:pointer;}
#volumeRange{-webkit-appearance:none;appearance:none;width:100%;height:8px;border-radius:999px;outline:none;
  background:linear-gradient(to right,#ff8a00 80%, #3c3c3c 0);}
#volumeRange::-webkit-slider-thumb{-webkit-appearance:none;width:18px;height:18px;border-radius:50%;
  background:#ff8a00;border:none;cursor:pointer;margin-top:-5px;}
#volumeRange::-moz-range-thumb{width:18px;height:18px;border:none;border-radius:50%;background:#ff8a00;cursor:pointer;}
</style>

<script>
const audio = document.getElementById("audioPlayer");
const playBtn = document.getElementById("playPauseBtn");
const playIcon = document.getElementById("playIcon");
const pauseIcon = document.getElementById("pauseIcon");
const canvas = document.getElementById("waveform");
const ctx = canvas.getContext("2d");
const volRange = document.getElementById("volumeRange");
const muteBtn  = document.getElementById("muteBtn");

let audioCtx, analyser, source, bufferLength, dataArray, rafId;
let useFakeVisualizer = false; // fallback flag
let fakePhase = 0;

// ---- Volumen persistente ----
const SAVED_VOL = localStorage.getItem("sr_volume");
audio.volume = SAVED_VOL ? parseFloat(SAVED_VOL) : parseFloat(volRange.value);
volRange.value = audio.volume;
updateRangeFill();

// ---- Visualizador ----
function resizeCanvas(){ canvas.width = canvas.offsetWidth; canvas.height = canvas.offsetHeight; }
resizeCanvas(); window.addEventListener("resize", resizeCanvas);

function initAudioContext(){
  if (audioCtx) return;
  audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  analyser = audioCtx.createAnalyser();
  source = audioCtx.createMediaElementSource(audio);
  source.connect(analyser);
  analyser.connect(audioCtx.destination);
  analyser.fftSize = 256;
  bufferLength = analyser.frequencyBinCount;
  dataArray = new Uint8Array(bufferLength);
}

function drawWaveform(){
  rafId = requestAnimationFrame(drawWaveform);

  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.lineWidth = 2;
  ctx.strokeStyle = "#ff8a00";
  ctx.beginPath();

  if (useFakeVisualizer){
    // --- Visualizador simulado con ruido, volumen y latido ---
    const sliceWidth = canvas.width / 80;
    let x = 0;
    fakePhase += 0.15;

    // Escala seg√∫n volumen actual (m√≠n 0.2 para que no desaparezca)
    const intensity = Math.max(audio.volume, 0.2);

    // Pulso tipo ‚Äúlatido‚Äù (0.05 = velocidad del beat, 1.5 = fuerza)
    const beat = (Math.sin(Date.now() * 0.005) * 0.5 + 1) * 1.5;

    for (let i=0;i<80;i++){
      // Onda base
      let base = Math.sin(i*0.35 + fakePhase) * (canvas.height/3) * intensity * beat;
      // Ruido aleatorio controlado
      let noise = (Math.random() - 0.5) * (canvas.height/4) * intensity * beat;
      // Posici√≥n final Y
      const y = (canvas.height/2) + base + noise;
      i===0 ? ctx.moveTo(x,y) : ctx.lineTo(x,y);
      x += sliceWidth;
    }
  } else {
    // --- Visualizador real ---
    analyser.getByteTimeDomainData(dataArray);
    const avg = dataArray.reduce((a,b)=>a+b,0)/bufferLength;
    if (avg === 128){ 
      // ‚ö†Ô∏è Datos planos ‚Üí fallback
      useFakeVisualizer = true;
    }

    const sliceWidth = canvas.width / bufferLength;
    let x = 0;
    for (let i=0;i<bufferLength;i++){
      const v = dataArray[i]/128.0;
      const y = (v * canvas.height)/2;
      i===0 ? ctx.moveTo(x,y) : ctx.lineTo(x,y);
      x += sliceWidth;
    }
  }

  ctx.stroke();
}

// ---- Play / Pausa ----
playBtn.addEventListener("click", async ()=>{
  if (audio.paused){
    if (!audioCtx){
      initAudioContext();
      try { await audioCtx.resume(); } catch(e){}
    }
    try {
      await audio.play();
      drawWaveform();
    } catch(e){ console.log("Error:", e); }
    playIcon.style.display = "none";
    pauseIcon.style.display = "inline";
  } else {
    audio.pause();
    if (rafId) cancelAnimationFrame(rafId);
    playIcon.style.display = "inline";
    pauseIcon.style.display = "none";
  }
});

// ---- Volumen + Mute ----
function updateRangeFill(){
  const val = (parseFloat(volRange.value)*100).toFixed(0);
  volRange.style.background = `linear-gradient(to right,#ff8a00 ${val}%, #3c3c3c ${val}%)`;
}
volRange.addEventListener("input", ()=>{
  audio.volume = parseFloat(volRange.value);
  localStorage.setItem("sr_volume", audio.volume);
  updateRangeFill();
  muteBtn.textContent = audio.volume === 0 ? "üîá" : "üîä";
});
muteBtn.addEventListener("click", ()=>{
  if (audio.volume > 0){
    muteBtn.dataset.prev = audio.volume;
    audio.volume = 0; volRange.value = "0";
    muteBtn.textContent = "üîá";
  } else {
    const prev = parseFloat(muteBtn.dataset.prev || "0.8");
    audio.volume = prev; volRange.value = audio.volume;
    muteBtn.textContent = "üîä";
  }
  localStorage.setItem("sr_volume", audio.volume);
  updateRangeFill();
});
</script>

<div id="now-playing">Cargando canci√≥n...</div>

<script>
async function cargarMetadata() {
  try {
    const response = await fetch("https://stream.zeno.fm/ezq3fcuf5ehvv?json=1");
    const data = await response.json();

    if (data.artist && data.title) {
      document.getElementById("now-playing").innerText =
        `üéµ ${data.artist} - ${data.title}`;
    } else {
      document.getElementById("now-playing").innerText = "üî¥ Transmisi√≥n en vivo";
    }
  } catch (error) {
    console.error("Error al cargar metadata:", error);
  }
}

// Actualizar cada 20 segundos
setInterval(cargarMetadata, 20000);
cargarMetadata();
</script>



  <!-- Social Media -->
  <section class="social-section">
    <div class="container">
      <h2 class="section-title">Redes Sociales</h2>
      <div class="social-buttons">
        <a href="https://chat.whatsapp.com/L3qooPAvdXMBmos5oWTKgH" target="_blank" class="social-btn whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
        <a href="https://www.facebook.com/share/19CxAjJvb8/?mibextid=wwXIfr" target="_blank" class="social-btn facebook">
          <i class="fab fa-facebook-f"></i>
        </a>
        <a href="https://www.instagram.com/sonar_rockgdl?igsh=bjlma2JpMXQwbDBv" target="_blank" class="social-btn instagram">
          <i class="fab fa-instagram"></i>
        </a>
        <a href="https://open.spotify.com/show/6mPcjQLeDdCwxzJe3PLlyU?si=TiadCqdlRCyd97QygWQWfA" target="_blank" class="social-btn spotify">
          <i class="fab fa-spotify"></i>
        </a>
        <a href="https://go.ivoox.com/sq/2661206" target="_blank" class="social-btn ivoox">
          <i class="fas fa-podcast"></i>
        </a>
      </div>
    </div>
  </section>

  <section class="embed-section">
  <div class="container" style="max-width: 650px; margin: auto;">
    <h2 class="section-title" style="margin-bottom: 15px;">Escucha en Spotify</h2>
    <div class="player-wrapper">
      <!-- Spotify Embed -->
      <iframe
        src="https://open.spotify.com/embed/show/6mPcjQLeDdCwxzJe3PLlyU?si=TiadCqdlRCyd97QygWQWfA"
        width="100%"
        height="170"
        frameborder="0"
        allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
        loading="lazy"
        style="border-radius: 12px; box-shadow: 0 8px 24px rgb(0 0 0 / 0.6);">
      </iframe>
    </div>

    <h2 class="section-title" style="margin: 30px 0 15px;">Escucha en iVoox</h2>
    <div id="podcast-player" class="player-wrapper"></div>
  </div>
</section>

<style>
  .player-wrapper {
    width: 100%;
    max-width: 650px;
    height: 170px;
    background: #121212;
    border-radius: 12px;
    box-shadow: 0 8px 24px rgb(0 0 0 / 0.6);
    display: flex;
    align-items: center;
    padding: 15px 20px;
    box-sizing: border-box;
    color: #fff;
    font-family: "Spotify Circular", Arial, sans-serif;
    gap: 20px;
  }
  #podcast-player > div {
    display: flex;
    width: 100%;
    gap: 20px;
    align-items: center;
  }
  #podcast-player img {
    width: 140px;
    height: 140px;
    border-radius: 12px;
    object-fit: cover;
    flex-shrink: 0;
  }
  #podcast-player h3 {
    font-size: 16px;
    margin: 0 0 6px 0;
    font-weight: 700;
    color: #faf8f7; 
  }
  #podcast-player p {
    font-size: 9px;
    color: #b3b3b3;
    margin: 0 0 10px 0;
  }
  #podcast-player audio {
    width: 100%;
    outline: none;
    filter: drop-shadow(0 1px 1px rgba(0,0,0,0.5));
    border-radius: 8px;
    background: #222;
  }
  .section-title {
    color: #FF6600 !important;
    font-family: "Spotify Circular", Arial, sans-serif;
  }
</style>

<script>
  async function loadLatestIvooxEpisode() {
    const feedUrl = "https://corsproxy.io/?https://www.ivoox.com/feed_fg_f12661206_filtro_1.xml";

    try {
      const response = await fetch(feedUrl);
      const xmlText = await response.text();
      const parser = new DOMParser();
      const xml = parser.parseFromString(xmlText, "text/xml");

      const item = xml.querySelector("item");
      if (!item) throw new Error("No se encontr√≥ ning√∫n episodio");

      const title = item.querySelector("title").textContent;
      const audioUrl = item.querySelector("enclosure").getAttribute("url");
      const pubDate = new Date(item.querySelector("pubDate").textContent).toLocaleDateString();
      const imageUrl = item.querySelector("itunes\\:image, image")?.getAttribute("href") || "https://static-1.ivoox.com/img/podcast_default.jpg";

      const playerHTML = `
        <div>
          <img src="${imageUrl}" alt="Car√°tula episodio" />
          <div style="flex:1;">
            <h3>${title}</h3>
            <p>Publicado el ${pubDate}</p>
            <audio controls preload="none">
              <source src="${audioUrl}" type="audio/mpeg" />
              Tu navegador no soporta audio HTML5.
            </audio>
          </div>
        </div>
      `;

      document.getElementById("podcast-player").innerHTML = playerHTML;
    } catch (error) {
      document.getElementById("podcast-player").innerHTML = `<p style="color:#f00;">No se pudo cargar el reproductor. Intenta m√°s tarde.</p>`;
      console.error("Error cargando el feed:", error);
    }
  }

  loadLatestIvooxEpisode();
</script>
  </div>
    </section>

  <!-- Staff Section -->
  <section class="staff-section">
    <div class="container">
      <h2 class="section-title">Nuestro Staff</h2>
      <div class="staff-grid">
        <div class="staff-member">
          <img src="attached_assets/Wendy_1749601460841.jpeg" alt="Wendy" class="staff-image">
          <h3>Wendy</h3>
        </div>
        <div class="staff-member">
          <img src="attached_assets/Alvaro_1749601460841.jpeg" alt="Alvaro" class="staff-image">
          <h3>El Contralor</h3>
        </div>
        <div class="staff-member">
          <img src="attached_assets/Hans_1749601460841.jpeg" alt="Hans" class="staff-image">
          <h3>Hans</h3>
        </div>
        <div class="staff-member">
          <img src="attached_assets/El Chris_1749601460841.jpeg" alt="El Chris" class="staff-image">
          <h3>El Chris</h3>
        </div>
      </div>
    </div>
  </section>

  <!-- About Sections -->
    <section class="about-section">
        <div class="container">
            <div class="about-content">
                <h2 class="section-title">¬øQui√©nes Somos?</h2>
                <p class="about-text">
                    Sonar Rock es una trinchera sonora, un espacio libre y apasionado que nace en M√©xico con una misi√≥n clara: ser un foro abierto para las bandas emergentes de la escena local. Creemos en el talento que nace en los garajes, en las letras que cuentan historias reales, en los riffs que a√∫n no han llegado a la radio comercial‚Ä¶ pero que merecen ser escuchados. Somos la radio independiente porque no seguimos formatos impuestos ni playlists predecibles. Aqu√≠, el rock tiene todas sus caras: lo cl√°sico que marc√≥ generaciones, lo contempor√°neo que sacude conciencias, y lo nuevo que est√° construyendo el futuro del g√©nero desde lo subterr√°neo hacia la superficie.
                </p>
            </div>
        </div>
    </section>

    <section class="about-section">
        <div class="container">
            <div class="about-content">
                <h2 class="section-title">¬øQu√© es Sonar Rock?</h2>
                <p class="about-text">
                    En Sonar Rock, celebramos la esencia del rock n‚Äô roll: su rebeld√≠a, su poes√≠a, su energ√≠a y su eterna capacidad de conectar almas. Transmitimos con el coraz√≥n puesto en cada acorde, convencidos de que la m√∫sica aut√©ntica todav√≠a tiene mucho que decir. Sonar Rock: donde el presente del rock se encuentra con su historia‚Ä¶ y con su porvenir.
                </p>
            </div>
        </div>
    </section>
  </section>

  <!-- Scripts -->
  <script>
  document.addEventListener('DOMContentLoaded', function() {
    const playBtn = document.getElementById('playBtn');
    const audioPlayer = document.getElementById('audioPlayer');
    const volumeSlider = document.getElementById('volumeSlider');
    const bars = document.querySelectorAll('.bar');

    let isPlaying = false;
    let visualizerInterval;

    playBtn.addEventListener('click', function () {
      if (isPlaying) {
        audioPlayer.pause();
        playBtn.innerHTML = '<i class="fas fa-play"></i>';
        stopVisualizer();
      } else {
        audioPlayer.load();
        audioPlayer.play().catch(e => console.error('Error al reproducir:', e));
        playBtn.innerHTML = '<i class="fas fa-pause"></i>';
        startVisualizer();
      }
      isPlaying = !isPlaying;
    });

    volumeSlider.addEventListener('input', function () {
      audioPlayer.volume = this.value / 100;
    });

    function startVisualizer() {
      visualizerInterval = setInterval(() => {
        bars.forEach(bar => {
          const height = Math.random() * 30 + 5;
          bar.style.height = height + 'px';
        });
      }, 100);
    }

    function stopVisualizer() {
      clearInterval(visualizerInterval);
      bars.forEach(bar => bar.style.height = '5px');
    }

    audioPlayer.volume = 1.0;
  });
  </script>

</body>
</html>
